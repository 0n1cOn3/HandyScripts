$EXE_URL = "https://s3.amazonaws.com/jumpcloud-windows-agent/production/adint.exe"
$EXE_FILEPATH = "C:\\Program Files\\JumpCloud AD Bridge\\adint.exe"
$TMP_FILEPATH = "C:\\Windows\\Temp\\adint.exe"

$ErrorActionPreference = "Stop"
"Updating JumpCloud AD Bridge to latest version..."

# stop the AD Bridge service:
& Stop-Service adint

"Downloading AD Bridge update..."
# check the PowerShell version: Invoke-WebRequest is a PowerShell 3 command, so use WebClient on earlier versions:
$PSVersionExists = Test-Path variable:global:PSVersionTable
If ($PSVersionExists -eq $true -And $PSVersionTable.PSVersion.Major -ge 3) {
& Invoke-WebRequest $EXE_URL -OutFile $TMP_FILEPATH
}
Else { # on anything less that PS3, use WebClient:
$WebClient = New-Object System.Net.WebClient
$WebClient.DownloadFile($EXE_URL, $TMP_FILEPATH)
}
"Download successful. Updating AD Bridge agent..."

# copy file to final destination and remove tmp file:
copy $TMP_FILEPATH $EXE_FILEPATH
del $TMP_FILEPATH

# restart the service:
& Start-Service adint
"AD Bridge Agent updated successfully."

# SIG # Begin signature block
# MIIVHQYJKoZIhvcNAQcCoIIVDjCCFQoCAQExDzANBglghkgBZQMEAgEFADB5Bgor
# BgEEAYI3AgEEoGswaTA0BgorBgEEAYI3AgEeMCYCAwEAAAQQH8w7YFlLCE63JNLG
# KX7zUQIBAAIBAAIBAAIBAAIBADAxMA0GCWCGSAFlAwQCAQUABCC1/7eyHV/hFY8N
# PDKSGWpCN81PHZK7ll35wlYdUOGZCqCCCfkwggTQMIIDuKADAgECAgEHMA0GCSqG
# SIb3DQEBCwUAMIGDMQswCQYDVQQGEwJVUzEQMA4GA1UECBMHQXJpem9uYTETMBEG
# A1UEBxMKU2NvdHRzZGFsZTEaMBgGA1UEChMRR29EYWRkeS5jb20sIEluYy4xMTAv
# BgNVBAMTKEdvIERhZGR5IFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9yaXR5IC0gRzIw
# HhcNMTEwNTAzMDcwMDAwWhcNMzEwNTAzMDcwMDAwWjCBtDELMAkGA1UEBhMCVVMx
# EDAOBgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNjb3R0c2RhbGUxGjAYBgNVBAoT
# EUdvRGFkZHkuY29tLCBJbmMuMS0wKwYDVQQLEyRodHRwOi8vY2VydHMuZ29kYWRk
# eS5jb20vcmVwb3NpdG9yeS8xMzAxBgNVBAMTKkdvIERhZGR5IFNlY3VyZSBDZXJ0
# aWZpY2F0ZSBBdXRob3JpdHkgLSBHMjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC
# AQoCggEBALngyxDUr3a91JNi6zBkuIEIbMME2WIXji//PmXPj85i5jxSHNoWRUtV
# q3hrY4NikM4PaWyZyBoUi0zMRTPqiNyeo68r/oBhnXlXxM8u9D8wPF1H/JoWvMM3
# lkFRjhFLVPgovtCMvvAwOB7zsCb4Zkdjbd5xJkePOEdT0UYdtOPcAOpFrL28cdmq
# bwDb280wOnlPX0xH+B3vW8LEnWA7sbJDkdikM07qs9YnT60liqXG9NXQpq50BWRX
# iLVEVdQtKjo++Li96TIKApRkxBY6UPFKrud5M68MIAd/6N8EOcJpAmxjUvp3wRvI
# dIfIuZMYUFQ1S2lOvDvTSS4f3MHSUvsCAwEAAaOCARowggEWMA8GA1UdEwEB/wQF
# MAMBAf8wDgYDVR0PAQH/BAQDAgEGMB0GA1UdDgQWBBRAwr0njsw0gzCiM9f7bLPw
# tCyAzjAfBgNVHSMEGDAWgBQ6moUHEGcotu/2vQVBbiDBlNoP3jA0BggrBgEFBQcB
# AQQoMCYwJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmdvZGFkZHkuY29tLzA1BgNV
# HR8ELjAsMCqgKKAmhiRodHRwOi8vY3JsLmdvZGFkZHkuY29tL2dkcm9vdC1nMi5j
# cmwwRgYDVR0gBD8wPTA7BgRVHSAAMDMwMQYIKwYBBQUHAgEWJWh0dHBzOi8vY2Vy
# dHMuZ29kYWRkeS5jb20vcmVwb3NpdG9yeS8wDQYJKoZIhvcNAQELBQADggEBAAh+
# bJMQyDi4lqmQS/+hX08E72w+nIgGyVCPpnP3VzEbvrzkL9v4utNb4LTn5nliDgyi
# 12pjczG19ahIpDsILaJdkNe0fCVPEVYwxLZEnXssneVe5u8MYaq/5Cob7oSeuIN9
# wUPORKcTcA2RH/TIE62DYNnYcqhzJB61rCIOyheJYlhEG6uJJQEAD83EG2LbUbTT
# D1Eqm/S8c/x2zjakzdnYLOqum/UqspDRTXUYij+KQZAjfVtL/qQDWJtGssNgYIP4
# fVBBzsKhkMO77wIv0hVU7kQV2Qqup4oz7bEtdjYm3ATrn/dhHxXch2/uRpYoraEm
# fQoJpy4Eo428+LwEMAEwggUhMIIECaADAgECAgkA0i1JGSCapxIwDQYJKoZIhvcN
# AQELBQAwgbQxCzAJBgNVBAYTAlVTMRAwDgYDVQQIEwdBcml6b25hMRMwEQYDVQQH
# EwpTY290dHNkYWxlMRowGAYDVQQKExFHb0RhZGR5LmNvbSwgSW5jLjEtMCsGA1UE
# CxMkaHR0cDovL2NlcnRzLmdvZGFkZHkuY29tL3JlcG9zaXRvcnkvMTMwMQYDVQQD
# EypHbyBEYWRkeSBTZWN1cmUgQ2VydGlmaWNhdGUgQXV0aG9yaXR5IC0gRzIwHhcN
# MTcwODI0MDM1MjAwWhcNMjAwODI0MDM1MjAwWjBiMQswCQYDVQQGEwJVUzERMA8G
# A1UECBMIQ29sb3JhZG8xEDAOBgNVBAcTB0JvdWxkZXIxFjAUBgNVBAoTDUp1bXBD
# bG91ZCBJbmMxFjAUBgNVBAMTDUp1bXBDbG91ZCBJbmMwggEiMA0GCSqGSIb3DQEB
# AQUAA4IBDwAwggEKAoIBAQDmr+d1zWgnwV7BLgZE3Iv0Mzu8hxbImawcvRBrfr/O
# +QKZ6pkEex7vsi57U8SVaK1bGLn/+GuQQLg+alCjOckOtO2t1954KUne9U6FCD5v
# wMr1Df1q0zbcIKE5Wa0wBHNvev/jBhVtlkLo6JHw+N4ZGe68WUkHwB0fb2NFSMnj
# NsXl09pqK0X/VBOXP9EZCq76TKALfzrX9KNHtW77dm1dBt3wUlTkKXg/cS/za+WU
# IZBQ9qODaeEFe+yZ+Z6/17Xm9lWhiUjVXPTGe/ZRtJG+b1of7O8B08QblOM4Js0F
# 195BNSw5MVpnTi6LFvBi6PzODQSvyRLmI2cxkDcDDG65AgMBAAGjggGFMIIBgTAM
# BgNVHRMBAf8EAjAAMBMGA1UdJQQMMAoGCCsGAQUFBwMDMA4GA1UdDwEB/wQEAwIH
# gDA1BgNVHR8ELjAsMCqgKKAmhiRodHRwOi8vY3JsLmdvZGFkZHkuY29tL2dkaWcy
# czUtMy5jcmwwXQYDVR0gBFYwVDBIBgtghkgBhv1tAQcXAjA5MDcGCCsGAQUFBwIB
# FitodHRwOi8vY2VydGlmaWNhdGVzLmdvZGFkZHkuY29tL3JlcG9zaXRvcnkvMAgG
# BmeBDAEEATB2BggrBgEFBQcBAQRqMGgwJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3Nw
# LmdvZGFkZHkuY29tLzBABggrBgEFBQcwAoY0aHR0cDovL2NlcnRpZmljYXRlcy5n
# b2RhZGR5LmNvbS9yZXBvc2l0b3J5L2dkaWcyLmNydDAfBgNVHSMEGDAWgBRAwr0n
# jsw0gzCiM9f7bLPwtCyAzjAdBgNVHQ4EFgQUCOwtWe9sQVeVW487dlW00XPNHwww
# DQYJKoZIhvcNAQELBQADggEBAE1EX8k/jqgV6n/wBJ/vNcyBawThh3LNJAJLRgMx
# 3WLuNHMtnOU8yMrR+SJsiFN4qKSEkjLq42bnwqAWW10Vh+cvnOV/yG6ibrYYuBKw
# gcuUdx/y7800wMnXXaLRpLLwGL2XnYWsXKQ9M21kKjrVH1iv4+t8+5Biq1L4hhN+
# EvFuFkOj9rhbtfr0uy51Kqj/sy+4GUkeR2xG005dhmPSTw3Tc2CuPG/BgRB8X7k4
# U+xHnIR+JBkxcW9p1YtzjWJ9Gq6vpRTxbY9zPat00xBqPDEryl7IdwWvreqlhBA8
# QO4MwHTtV4tXqz3l7NfuNbcLtGn2MkABy+WkRQyz6I/XoSoxggp6MIIKdgIBATCB
# wjCBtDELMAkGA1UEBhMCVVMxEDAOBgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNj
# b3R0c2RhbGUxGjAYBgNVBAoTEUdvRGFkZHkuY29tLCBJbmMuMS0wKwYDVQQLEyRo
# dHRwOi8vY2VydHMuZ29kYWRkeS5jb20vcmVwb3NpdG9yeS8xMzAxBgNVBAMTKkdv
# IERhZGR5IFNlY3VyZSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgLSBHMgIJANItSRkg
# mqcSMA0GCWCGSAFlAwQCAQUAoHwwEAYKKwYBBAGCNwIBDDECMAAwGQYJKoZIhvcN
# AQkDMQwGCisGAQQBgjcCAQQwHAYKKwYBBAGCNwIBCzEOMAwGCisGAQQBgjcCARUw
# LwYJKoZIhvcNAQkEMSIEIAF1QPjZj3ZhdIDnBQmaiLVOv2TA3V9NBlPz8NgSd1/z
# MA0GCSqGSIb3DQEBAQUABIIBAF2K9D/VDxl3jRpWnZr+M1iKvJEyfO/pUE6hyRvi
# yN4NcPAr7ARzLpc6XjBJPO1HRqm9sIZPuHtTWwUiP3ZNHcSak/6fbbLthiTABnF2
# 7GTQ4b/YBdCGqPjONLCLAch6TvaelG9vxh6b0jx47+pzd/WGGxKJgmrxCsTuh4g9
# e7veptG3JWvyxzGjqS72MOb/BsA7BUiegIh2DUBEcErSi5sclVQ+s/MQPh65VS+G
# 5EQrltxsDMNci095YwYdaeKVGV/Q4+gxUiBG5ArcUhzBQHfHkHTl8od3sK7q7yHl
# m4DHXkopmHw+hhDWFWfVIindhZnrs2kL+JOlEGhki6Uo/8ShgggKMIIIBgYKKwYB
# BAGCNwMDATGCB/YwggfyBgkqhkiG9w0BBwKgggfjMIIH3wIBAzEPMA0GCWCGSAFl
# AwQCAQUAMG0GCyqGSIb3DQEJEAEEoF4EXDBaAgEBBgpghkgBhv1uAQcYMDEwDQYJ
# YIZIAWUDBAIBBQAEIM3X2UMqR8EBEdRZXpaDf4SDhs8M5Yx5m0hvhkDZiot4AgUD
# AIxX3hgPMjAxNzA4MjUyMDA3MjNaoIIE8TCCBO0wggPVoAMCAQICCDxuPX0jNiVN
# MA0GCSqGSIb3DQEBCwUAMIGPMQswCQYDVQQGEwJVUzEQMA4GA1UECBMHQXJpem9u
# YTETMBEGA1UEBxMKU2NvdHRzZGFsZTElMCMGA1UEChMcU3RhcmZpZWxkIFRlY2hu
# b2xvZ2llcywgSW5jLjEyMDAGA1UEAxMpU3RhcmZpZWxkIFJvb3QgQ2VydGlmaWNh
# dGUgQXV0aG9yaXR5IC0gRzIwHhcNMTYxMjEzMDcwMDAwWhcNMjExMjEzMDcwMDAw
# WjCBiDELMAkGA1UEBhMCVVMxEDAOBgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNj
# b3R0c2RhbGUxJTAjBgNVBAoTHFN0YXJmaWVsZCBUZWNobm9sb2dpZXMsIEluYy4x
# KzApBgNVBAMTIlN0YXJmaWVsZCBUaW1lc3RhbXAgQXV0aG9yaXR5IC0gRzIwggEi
# MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDDErfsw30Hf/hAxEiB+MSDi8yZ
# AoDhaslimDLFY72B+7wnZVNBABrtgJc2IiIym2hmC20BbTn/qIWoi5ensF9OBSJn
# VunPe+VKInvl5zBmDlckp1hyF7/6unxV+0YMIedLzjAg7ihwgqcdzK2FOYNJD9yf
# j7L/YxNjXNI5Dnh0Gna6VU6PBxglqM+1wixSHwnY41pKAy7uAdP/cnoTWgvmcKzs
# vXJ1BDYZxP/tFjCKFHTi5A/xKtuAE1QVVwXu0N6OP+4c2Fj6AAYoKx6QeqtbtSC6
# QfmXtit63Vs+Lfd5Psqgsm52VRSriWcud1UuDw7M34kR3yBGaNk2RgYCFX1/AgMB
# AAGjggFQMIIBTDAMBgNVHRMBAf8EAjAAMA4GA1UdDwEB/wQEAwIGwDAWBgNVHSUB
# Af8EDDAKBggrBgEFBQcDCDAdBgNVHQ4EFgQUxYZKIX7Z8rV9oQGsrF5d/hWC978w
# HwYDVR0jBBgwFoAUfAwyH6fZMH/EfWijYqihzqsHWycwOgYIKwYBBQUHAQEELjAs
# MCoGCCsGAQUFBzABhh5odHRwOi8vb2NzcC5zdGFyZmllbGR0ZWNoLmNvbS8wRgYD
# VR0fBD8wPTA7oDmgN4Y1aHR0cDovL2NybC5zdGFyZmllbGR0ZWNoLmNvbS9yZXBv
# c2l0b3J5L3Nmcm9vdC1nMi5jcmwwUAYDVR0gBEkwRzBFBgtghkgBhv1uAQcXAjA2
# MDQGCCsGAQUFBwIBFihodHRwOi8vY3JsLnN0YXJmaWVsZHRlY2guY29tL3JlcG9z
# aXRvcnkvMA0GCSqGSIb3DQEBCwUAA4IBAQAtU55thxtW4dXd/UHtjVqvQscbWURx
# twUdIY4Fc53xIL/SO30kK5ym7hNatN6+wZC8mee6kDyBze0pvw7X0aUP18zt1f0i
# nF3B6S0mTYwl9/HE6+AaZ5NE80BbQmIhRoxGOuqbwyyji3ZKV6n3WY8QsoaQAK5X
# B/RIThxDI1w4CZ7qxLUhuBuUaUtf4QOgQyOvr/64EwhLilFQlTMJFFhefnpazbdl
# DdkiQLsEcKGHXU8N8OvBVOmJT8nS/QxsXUvFMz+LnaX5LmRnpLx5tp4pGw/uCezQ
# 15uJPXNjczMG3VZYOywwqKlZ7WqTkKmUuFzKkg+v3qP19eBQcIceLQetMYICYzCC
# Al8CAQEwgZwwgY8xCzAJBgNVBAYTAlVTMRAwDgYDVQQIEwdBcml6b25hMRMwEQYD
# VQQHEwpTY290dHNkYWxlMSUwIwYDVQQKExxTdGFyZmllbGQgVGVjaG5vbG9naWVz
# LCBJbmMuMTIwMAYDVQQDEylTdGFyZmllbGQgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRo
# b3JpdHkgLSBHMgIIPG49fSM2JU0wDQYJYIZIAWUDBAIBBQCggZgwGgYJKoZIhvcN
# AQkDMQ0GCyqGSIb3DQEJEAEEMBwGCSqGSIb3DQEJBTEPFw0xNzA4MjUyMDA3MjNa
# MCsGCyqGSIb3DQEJEAIMMRwwGjAYMBYEFHFEtT8aXTkd3axxtgchkIybG/P2MC8G
# CSqGSIb3DQEJBDEiBCAzFYM9a3Qk9oVyQdWxLLSVb9YRE53oZmxIjmQMrJWfKTAN
# BgkqhkiG9w0BAQEFAASCAQCBYfWVWwtNlPRc4UQfKMU/8z2k3alqM4GZyMdnukmt
# FuKT9r+cOt3bJyhuZbr5ULzIJw2HnEp47volWbCOieo1Sf/MSkE1lqQZqeOwkqHV
# DK91GlPvkqIIcHTccGwlPHFvcUEo+sk/snzysuOsDbrQJqFS5wpfwVlygqQuLhNM
# E5d7yxlBR3ReqCbTzJRBTfLdTQGzV246DBDMakij0JpSiA7iQ+rzBiZiywLLzFwx
# At+99f1QP80+8bgBJsDMar3QjS76PLB9hEQTJZfxuTgvED0LCP9xobc/1xz2e1vN
# 9PX4G+XaCqqEdPeNshw2WROYjnGPpa3JC+tO4DQSGn19
# SIG # End signature block
